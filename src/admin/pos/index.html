<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/alpinejs@2.8.2/dist/alpine.min.js"
      defer
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <script src="/src/admin/assets/js/app.js" defer></script>
  </head>

  <body
    class="bg-gray-100 h-screen w-full"
    x-data="{
      menu: true, 
      showBack: window.location.pathname.includes('/src/admin/pos'),
      searchQuery: '',
      customerQuery: '',
      counts: Array(20).fill(0),
      items: Array.from({ length: 20 }, (_, i) => `Item ${i + 1}`), // Generate item names dynamically
      categories: Array.from({ length: 20 }, (_, i) => `Category ${i + 1}`), // Generate item names dynamically
      customers: Array.from({ length: 20 }, (_, i) => `Customer ${i + 1}`), // Generate item names dynamically
      get filteredCustomers() {
        return this.customerQuery.trim() !== '' 
        ? this.customers
            .filter(c => c.toLowerCase().includes(this.customerQuery.toLowerCase()))
            .slice(0, 5)
        : [];
      },
      products: [],
      discount: 0,
      paymentMethod: 'cash',
      addProduct(name, price) {
        // Check if product already exists in the list
        let existingProduct = this.products.find(product => product.name === name);
        if (existingProduct) {
            existingProduct.quantity++;
        } else {
            this.products.push({ name: name, price: price, quantity: 1 });
        }
    }
    ,
      removeProduct(index) {
          this.products.splice(index, 1);
      },
      total() {
          return this.products.reduce((sum, product) => sum + (product.price * product.quantity), 0);
      },
      grandTotal() {
          return this.total() - this.discount;
      }
    }"
  >
    <div class="flex h-full">
      <div class="h-full w-full">
        <div id="header-container"></div>

        <!-- Content Section -->
        <div class="p-6 text-sm h-full">
          <div class="grid grid-cols-1 gap-6 w-full p-4 h-[90%]">
            <!-- Table Card -->
            <div
              class="shadow-2xl border-b-4 bg-white p-4 border-gray-300 rounded-2xl"
            >
              <div class="flex justify-between items-center my-1 p-2">
                <h3 class="text-lg font-bold mb-3 text-purple-600">POS</h3>
                <!-- <button
                  class="py-2 px-3 bg-purple-600 text-white rounded-md  font-semibold"
                >
                  Add
                </button> -->
              </div>

              <!-- Main Grid Section -->
              <div
                class="grid grid-cols-1 2xl:grid-cols-2 xl:grid-cols-2"
              >
                <div class="mb-2">
                  <div class="p-2">
                    <div
                      class="flex overflow-x-auto w-full snap-x snap-mandatory rounded-lg bg-gray-100"
                    >
                      <!-- Card Items -->
                      <div class="flex overflow-x-auto p-4 space-x-4 snap-x snap-mandatory">
                        <template x-for="(category, i) in categories" :key="i">
                          <div
                            class="flex items-center border px-6 py-2 rounded-lg shadow-lg bg-white h-12 flex-shrink-0 snap-center min-w-[100px] whitespace-nowrap"
                          >
                            <p class="text-gray-500 text-sm text-center" x-text="category"></p>
                          </div>
                        </template>
                      </div>

                    </div>

                    <div class="relative w-full mb-2 mt-2">
                      <input
                        type="text"
                        placeholder="Search Item"
                        x-model="searchQuery"
                        class="w-full pl-4 pr-10 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"
                      />
                      <i
                        data-feather="search"
                        class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500"
                      ></i>
                    </div>
                  </div>
                  <!-- Items Section -->
                  <div
                    class="grid grid-cols-1 2xl:grid-cols-4 md:grid-cols-2 xl:grid-cols-3 gap-4 overflow-y-auto p-2 h-[67vh]"
                  >
                    <!-- Search Bar -->

                    <!-- Card Items -->
                    <template x-for="(item, i) in items" :key="i">
                      <div  @click="addProduct(item, 50)"
                        x-show="item.toLowerCase().includes(searchQuery.toLowerCase())"
                        class="flex flex-col items-center border p-4 rounded-lg shadow-lg bg-white max-h-48 w-full"
                      >
                        <div
                          class="h-20 w-full bg-gray-100 rounded-xl mb-2"
                        ></div>

                        <div
                          class="flex justify-between items-center w-full mb-1 p-2"
                        >
                          <p class="text-gray-500 text-xs" x-text="item"></p>
                          <p class="text-md text-purple-800 italic font-bold">
                            $50
                          </p>
                        </div>

                        <div
                          class="flex items-center justify-between w-full p-2"
                        >
                          <button
                            @click="counts[i] > 0 ? counts[i]-- : 0"
                            class="bg-gray-500 text-white px-3 py-1 rounded"
                          >
                            -
                          </button>
                          <span class="text-lg font-bold" x-text="counts[i]"
                            >0</span
                          >
                          <button
                            @click="counts[i]++"
                            class="bg-yellow-500 text-white px-3 py-1 rounded"
                          >
                            +
                          </button>
                        </div>
                      </div>
                    </template>
                  </div>
                </div>
                <!-- Bill Section -->
                <div class="bg-white p-4 border shadow-md rounded-xl">
                  <!-- <h3 class="text-lg font-bold text-purple-600 mb-3">Bill</h3> -->
                  <div class="flex justify-between w-full mb-2 mt-2 items-center">
                   <div class="relative w-full">
                    <input
                      type="text"
                      placeholder="Search Customer"
                      x-model = "customerQuery"
                      class="w-full pl-4 pr-10 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"
                    />
                    <div x-show="filteredCustomers.length > 0" class="absolute w-full bg-white border rounded-lg shadow-lg mt-1 z-50">
                      <template x-for="customer in filteredCustomers" :key="customer">
                        <p class="px-4 py-2 hover:bg-gray-100 cursor-pointer" x-text="customer"></p>
                      </template>
                    </div>
                    </div>
                    <buton  class="py-2 px-3 ml-2 flex justify-center items-center bg-purple-600 text-white rounded-md  font-semibold"
                    >
                    +
                    <!-- <i
                    data-feather="plus"
                    class="ransform -translate-y-1/2 text-white"
                  ></i> -->
                    </button>
               
                  </div>
                 
                    <div class="grid grid-cols-4 font-bold border-b py-2">
                      <p>Particular</p>
                      <p>Price</p>
                      <p>Quantity</p>
                      <p>Total</p>
                    </div>
                    <div class="mb-4">
                      <template x-for="(product, index) in products" :key="index">
                        <div class="grid grid-cols-4 py-2 border-b items-center">
                          <p x-text="product.name"></p>
                          <p x-text="product.price"></p>
                          <div class="flex items-center justify-center">
                            <button @click="product.quantity--" :disabled="product.quantity <= 1" class="px-2 py-1 bg-gray-300 rounded-md">-</button>
                            <span class="px-4" x-text="product.quantity"></span>
                            <button @click="product.quantity++" class="px-2 py-1 bg-gray-300 rounded-md">+</button>
                          </div>
                          <p x-text="(product.price * product.quantity).toFixed(2)"></p>
                          <button @click="removeProduct(index)" class="text-red-500">
                            <i data-feather="trash"></i>
                          </button>
                        </div>
                      </template>
                    </div>
                    
                    <!-- Summary -->
<div class="mt-4 text-right">
  <p>Subtotal: <span x-text="total()"></span></p>
  <p>Discount: <input type="number" x-model.number="discount" class="border p-1 w-20 rounded-md text-right" /></p>
  <p class="font-bold">Grand Total: <span x-text="grandTotal()"></span></p>
</div>

<!-- Payment Section -->
<div class="mt-4 flex justify-between items-center">
  <select x-model="paymentMethod" class="border p-2 rounded-md">
    <option value="cash">Cash</option>
    <option value="card">Card</option>
    <option value="upi">UPI</option>
    <option value="other">Other</option>
  </select>
  <button class="py-2 px-4 bg-green-600 text-white rounded-md font-semibold">Save</button>
</div>

              </div>
            </div>
          </div>
        </div>
        <!-- End Content Section -->
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        feather.replace(); // Render Feather icons properly
      });
    </script>
    <script>
       document.addEventListener('alpine:init', () => {
        Alpine.data('posBill', () => ({
            customerQuery: '',
            filteredCustomers: [],
            products: [],
            discount: 0,
            paymentMethod: 'cash',
            addProduct(name, price) {
  let existingProduct = this.products.find(product => product.name === name);
  if (existingProduct) {
    existingProduct.quantity++;
  } else {
    this.products.push({ name: name, price: price, quantity: 1 });
  }
},
            removeProduct(index) {
                this.products.splice(index, 1);
            },
            total() {
                return this.products.reduce((sum, product) => sum + (product.price * product.quantity), 0);
            },
            grandTotal() {
                return this.total() - this.discount;
            }
        }));
    });
    </script>
  </body>
</html>
